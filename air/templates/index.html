{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Авіакомпанія</title>

  <!-- Підключення стилів -->
  <link href="https://fonts.googleapis.com/css2?family=Geologica:wght@100..900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="{% static 'styles.css' %}">

  <!-- Підключення скриптів -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>

<body>
  <section class="hero">
    <div style="margin-left: 80px; margin-right: 80px;">
      <header class="navbar">
        <div class="logo">
          <img src="{% static 'images/logo.svg' %}" width="200" height="50">
        </div>
        <nav class="nav-links">
          <a href="#flights">Рейси</a>
          <a href="#destinations">Напрямки</a>
          <a href="#services">Послуги</a>
          <a href="#contact">Контакти</a>
        </nav>
        <div class="login-container">
          {% if user.is_authenticated %}
           <a href="{% url 'kabinet' %}" class="login-link">Профіль</a>
          {% else %}
           <a href="{% url 'account' %}" class="login-link">Увійти</a>
          {% endif %}
        </div>
      </header>

      <h1 class="hero-title">Подорожуйте з комфортом</h1>
      <p class="hero-text">Бронюйте квитки по всьому світу за вигідними цінами.</p>

      <section id="search" style="margin-top: 100px;">
        <form id="search-form" class="search-form">
          <div class="trip-options">
            <label id="round-trip" class="selected-trip">Туди і назад</label>
            <label id="one-way" class="trip">В один бік</label>
          </div>

          <div class="search-fields">
            <input type="text" id="from" name="from" placeholder="Звідки" required>
            <input type="text" id="to" name="to" placeholder="Куди" required>
            <input type="text" class="first-date" required placeholder="Дата вильоту">
            <input type="text" class="second-date" required placeholder="Дата повернення">
            <button type="submit" class="btn-primary">
              <i class="fa-solid fa-magnifying-glass"></i>
            </button>
          </div>
        </form>
      </section>
    </div>
  </section>

  <section id="flights" class="flights-section">
    <h2>Результати пошуку</h2>
    <div id="flights-results"></div>
  </section>

  <footer class="footer">
    <div class="footer-bottom">
      <p>&copy; 2025 UkrAirFly. Усі права захищено.</p>
      <p><a href="#">Політика конфіденційності</a> | <a href="#">Умови використання</a></p>
    </div>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      console.log("Flatpickr завантажено:", typeof flatpickr !== "undefined");

      flatpickr(".first-date", { dateFormat: "d F Y", minDate: "today", clickOpens: true });
      flatpickr(".second-date", { dateFormat: "d F Y", minDate: "today", clickOpens: true });

      const roundTripLabel = document.getElementById("round-trip");
      const oneWayLabel = document.getElementById("one-way");
      const secondDateInput = document.querySelector(".second-date");

      oneWayLabel.addEventListener("click", function () {
          secondDateInput.style.display = "none";
          secondDateInput.value = "";
          roundTripLabel.classList.remove("selected-trip");
          oneWayLabel.classList.add("selected-trip");
      });

      roundTripLabel.addEventListener("click", function () {
          secondDateInput.style.display = "inline-block";
          oneWayLabel.classList.remove("selected-trip");
          roundTripLabel.classList.add("selected-trip");
      });

      // Пошук рейсів
      document.getElementById("search-form").addEventListener("submit", function(event) {
        event.preventDefault();
        let from = document.getElementById("from").value;
        let to = document.getElementById("to").value;
        let date = document.querySelector(".first-date").value;

        fetch(`/api/flights/?departure=${from}&arrival=${to}&date=${date}`)
        .then(response => response.json())
        .then(data => {
            let resultsDiv = document.getElementById("flights-results");
            resultsDiv.innerHTML = "";

            if (data.length === 0) {
                resultsDiv.innerHTML = `<p class="no-flights">❌ Рейсів не знайдено. Спробуйте змінити дату або напрямок.</p>`;
            } else {
                data.forEach(flight => {
                    resultsDiv.innerHTML += `
                        <div class="flight-card">
                            <h3>${flight.aircraft}</h3>
                            <p>Виліт: ${flight.departure_time}</p>
                            <button class="btn-secondary" onclick="viewSeats(${flight.id})">Обрати місце</button>
                        </div>
                    `;
                });
            }
        })
        .catch(error => {
            console.error("Помилка отримання рейсів:", error);
            document.getElementById("flights-results").innerHTML = `<p class="error">⚠️ Сталася помилка. Спробуйте ще раз.</p>`;
        });
      });

    });
  </script>
</body>
</html>
